var nn=Object.defineProperty;var tn=(e,n,i)=>n in e?nn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i;var m=(e,n,i)=>(tn(e,typeof n!="symbol"?n+"":n,i),i);import{S as z,i as X,s as Y,C as rn,k as S,a as q,l as C,m as T,h as L,c as O,n as b,p as I,b as E,J as r,K as k,L as w,D as sn,E as an,F as ln,g as B,d as N,M as V,N as on,o as un,O as K,P as a,w as F,Q as hn,H as P,R as dn,T as cn,y as W,z as G,A as H,B as J,I as fn}from"../chunks/index.39292025.js";import{r as pn}from"../chunks/index.3e4c3012.js";class gn{constructor(){m(this,"currentLayerId");m(this,"setups");m(this,"renderers");m(this,"dispatchers");m(this,"needsSetup");m(this,"needsRedraw");m(this,"context");m(this,"width");m(this,"height");m(this,"autoclear");m(this,"pixelRatio");m(this,"renderLoop");m(this,"layerObserver");m(this,"layerRef");m(this,"layerSequence");m(this,"renderingLayerId");m(this,"activeLayerId");m(this,"activeLayerDispatcher");this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.getRenderingLayerId=this.getRenderingLayerId.bind(this),this.currentLayerId=1,this.setups=new Map,this.renderers=new Map,this.dispatchers=new Map,this.needsSetup=!1,this.needsRedraw=!0,this.renderingLayerId=0,this.activeLayerId=0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}register({setup:n,render:i,dispatcher:s}){return n&&(this.setups.set(this.currentLayerId,n),this.needsSetup=!0),this.renderers.set(this.currentLayerId,i),this.dispatchers.set(this.currentLayerId,s),this.needsRedraw=!0,this.currentLayerId++}unregister(n){this.renderers.delete(n),this.dispatchers.delete(n),this.needsRedraw=!0}setup(n,i){this.context=n,this.layerRef=i,this.observeLayerSequence(),this.startRenderLoop()}observeLayerSequence(){this.layerObserver=new MutationObserver(this.getLayerSequence.bind(this)),this.layerObserver.observe(this.layerRef,{childList:!0}),this.getLayerSequence()}getLayerSequence(){const n=[...this.layerRef.children];this.layerSequence=n.map(i=>+(i.dataset.layerId??-1)),this.redraw()}startRenderLoop(){this.render(),this.renderLoop=requestAnimationFrame(()=>this.startRenderLoop())}render(){var g;const n=this.context,i=this.width,s=this.height,d=this.pixelRatio;if(this.needsSetup){for(const[c,u]of this.setups)u({context:n,width:i,height:s}),this.setups.delete(c);this.needsSetup=!1}if(this.needsRedraw){n.setTransform(d,0,0,d,0,0),this.autoclear&&n.clearRect(0,0,i,s);for(const c of this.layerSequence)this.renderingLayerId=c,(g=this.renderers.get(c))==null||g({context:n,width:i,height:s});this.needsRedraw=!1}}setActiveLayer(n,i){this.activeLayerId!==n&&(i instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerleave",i)),this.dispatchLayerEvent(new MouseEvent("mouseleave",i))),this.activeLayerId=n,this.activeLayerDispatcher=this.dispatchers.get(n),i instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerenter",i)),this.dispatchLayerEvent(new MouseEvent("mouseenter",i))))}dispatchLayerEvent(n){if(this.activeLayerDispatcher){if(window.TouchEvent&&n instanceof TouchEvent){const{left:i,top:s}=n.target.getBoundingClientRect(),{clientX:d,clientY:g}=n.changedTouches[0],c={x:d-i,y:g-s,originalEvent:n};this.activeLayerDispatcher(n.type,c)}else if(n instanceof MouseEvent){const i={x:n.offsetX,y:n.offsetY,originalEvent:n};this.activeLayerDispatcher(n.type,i)}}}getRenderingLayerId(){return this.renderingLayerId}destroy(){typeof window>"u"||(this.layerObserver.disconnect(),cancelAnimationFrame(this.renderLoop))}}const yn=e=>{const n=e*2,i=n>>16&255,s=n>>8&255,d=n&255;return`rgb(${i}, ${s}, ${d})`},_n=(e,n,i)=>{const s=(e<<16|n<<8|i)/2;return s%1?0:s},mn=["drawImage"],wn=["filter","shadowBlur","globalCompositeOperation","globalAlpha"],vn=["drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],Ln=e=>{let n;const i=document.createElement("canvas"),s=i.getContext("2d",{willReadFrequently:!0}),d=()=>{i.width=e.canvas.width,i.height=e.canvas.height};return new MutationObserver(d).observe(e.canvas,{attributeFilter:["width","height"]}),d(),new Proxy(e,{get(c,u){if(u==="_getLayerIdAtPixel")return(o,f)=>{const[v,_,l]=s.getImageData(o,f,1,1).data;return _n(v,_,l)};const h=c[u];return typeof h!="function"?h:function(...o){if(vn.includes(u)){const f=yn(n());s.fillStyle=f,s.strokeStyle=f}if(u==="drawImage"){const f=o.slice(1);s.fillRect(...f)}return mn.includes(u)||Reflect.apply(h,s,o),Reflect.apply(h,c,o)}},set(c,u,h){return u==="_renderingLayerId"?(n=h,!0):(c[u]=h,wn.includes(u)||(s[u]=h),!0)}})};function bn(e){let n,i,s,d=`${e[0]}px`,g=`${e[1]}px`,c,u,h,o,f;const v=e[18].default,_=rn(v,e,e[17],null);return{c(){n=S("canvas"),c=q(),u=S("div"),_&&_.c(),this.h()},l(l){n=C(l,"CANVAS",{width:!0,height:!0,class:!0,style:!0}),T(n).forEach(L),c=O(l),u=C(l,"DIV",{});var p=T(u);_&&_.l(p),p.forEach(L),this.h()},h(){b(n,"width",i=e[0]*e[5]),b(n,"height",s=e[1]*e[5]),b(n,"class",e[4]),b(n,"style",e[2]),I(n,"display","block"),I(n,"width",d),I(n,"height",g),I(u,"display","none")},m(l,p){E(l,n,p),e[64](n),E(l,c,p),E(l,u,p),_&&_.m(u,null),e[65](u),h=!0,o||(f=[r(n,"touchstart",k(function(){w(e[3]?e[9]:null)&&(e[3]?e[9]:null).apply(this,arguments)})),r(n,"mousemove",function(){w(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),r(n,"pointermove",function(){w(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),r(n,"click",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"contextmenu",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"dblclick",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"mousedown",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"mouseenter",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"mouseleave",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"mouseup",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"wheel",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"touchcancel",k(function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),r(n,"touchend",k(function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),r(n,"touchmove",k(function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),r(n,"pointerenter",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"pointerleave",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"pointerdown",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"pointerup",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"pointercancel",function(){w(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),r(n,"focus",e[19]),r(n,"blur",e[20]),r(n,"fullscreenchange",e[21]),r(n,"fullscreenerror",e[22]),r(n,"scroll",e[23]),r(n,"cut",e[24]),r(n,"copy",e[25]),r(n,"paste",e[26]),r(n,"keydown",e[27]),r(n,"keypress",e[28]),r(n,"keyup",e[29]),r(n,"auxclick",e[30]),r(n,"click",e[31]),r(n,"contextmenu",e[32]),r(n,"dblclick",e[33]),r(n,"mousedown",e[34]),r(n,"mouseenter",e[35]),r(n,"mouseleave",e[36]),r(n,"mousemove",e[37]),r(n,"mouseover",e[38]),r(n,"mouseout",e[39]),r(n,"mouseup",e[40]),r(n,"select",e[41]),r(n,"wheel",e[42]),r(n,"drag",e[43]),r(n,"dragend",e[44]),r(n,"dragenter",e[45]),r(n,"dragstart",e[46]),r(n,"dragleave",e[47]),r(n,"dragover",e[48]),r(n,"drop",e[49]),r(n,"touchcancel",e[50]),r(n,"touchend",e[51]),r(n,"touchmove",e[52]),r(n,"touchstart",e[53]),r(n,"pointerover",e[54]),r(n,"pointerenter",e[55]),r(n,"pointerdown",e[56]),r(n,"pointermove",e[57]),r(n,"pointerup",e[58]),r(n,"pointercancel",e[59]),r(n,"pointerout",e[60]),r(n,"pointerleave",e[61]),r(n,"gotpointercapture",e[62]),r(n,"lostpointercapture",e[63])],o=!0)},p(l,p){e=l,(!h||p[0]&33&&i!==(i=e[0]*e[5]))&&b(n,"width",i),(!h||p[0]&34&&s!==(s=e[1]*e[5]))&&b(n,"height",s),(!h||p[0]&16)&&b(n,"class",e[4]),(!h||p[0]&4)&&b(n,"style",e[2]);const R=p[0]&4;R&&I(n,"display","block"),(R||p[0]&5&&d!==(d=`${e[0]}px`))&&I(n,"width",d),(R||p[0]&6&&g!==(g=`${e[1]}px`))&&I(n,"height",g),_&&_.p&&(!h||p[0]&131072)&&sn(_,v,e,e[17],h?ln(v,e[17],p,null):an(e[17]),null)},i(l){h||(B(_,l),h=!0)},o(l){N(_,l),h=!1},d(l){l&&L(n),e[64](null),l&&L(c),l&&L(u),_&&_.d(l),e[65](null),o=!1,V(f)}}}const Q=Symbol(),Rn=()=>hn(Q);function En(e,n,i){let s,{$$slots:d={},$$scope:g}=n,{width:c=640,height:u=640,pixelRatio:h=null,style:o="",autoclear:f=!0,layerEvents:v=!1}=n,{class:_=""}=n,l,p=null,R;const y=new gn;function x(){y.redraw()}function $(){return l}function ee(){return p}h==null&&(typeof window<"u"?h=window.devicePixelRatio:h=2),on(Q,{register:y.register,unregister:y.unregister,redraw:y.redraw}),un(()=>{const t=l.getContext("2d");v?(p=Ln(t),p._renderingLayerId=y.getRenderingLayerId):p=t,y.setup(p,R)}),K(()=>y.destroy());const ne=t=>{const D=t.offsetX*s,A=t.offsetY*s,M=p._getLayerIdAtPixel(D,A);y.setActiveLayer(M,t),y.dispatchLayerEvent(t)},te=t=>{const{clientX:D,clientY:A}=t.changedTouches[0],{left:M,top:Ze}=l.getBoundingClientRect(),xe=(D-M)*s,$e=(A-Ze)*s,en=p._getLayerIdAtPixel(xe,$e);y.setActiveLayer(en,t),y.dispatchLayerEvent(t)},ie=t=>{window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),y.dispatchLayerEvent(t)};function re(t){a.call(this,e,t)}function se(t){a.call(this,e,t)}function ae(t){a.call(this,e,t)}function le(t){a.call(this,e,t)}function oe(t){a.call(this,e,t)}function ue(t){a.call(this,e,t)}function he(t){a.call(this,e,t)}function de(t){a.call(this,e,t)}function ce(t){a.call(this,e,t)}function fe(t){a.call(this,e,t)}function pe(t){a.call(this,e,t)}function ge(t){a.call(this,e,t)}function ye(t){a.call(this,e,t)}function _e(t){a.call(this,e,t)}function me(t){a.call(this,e,t)}function we(t){a.call(this,e,t)}function ve(t){a.call(this,e,t)}function Le(t){a.call(this,e,t)}function be(t){a.call(this,e,t)}function Re(t){a.call(this,e,t)}function Ee(t){a.call(this,e,t)}function Ie(t){a.call(this,e,t)}function Se(t){a.call(this,e,t)}function Ce(t){a.call(this,e,t)}function ke(t){a.call(this,e,t)}function Te(t){a.call(this,e,t)}function De(t){a.call(this,e,t)}function Ae(t){a.call(this,e,t)}function Me(t){a.call(this,e,t)}function Pe(t){a.call(this,e,t)}function qe(t){a.call(this,e,t)}function Oe(t){a.call(this,e,t)}function Fe(t){a.call(this,e,t)}function ze(t){a.call(this,e,t)}function Xe(t){a.call(this,e,t)}function Ye(t){a.call(this,e,t)}function Be(t){a.call(this,e,t)}function Ne(t){a.call(this,e,t)}function Ue(t){a.call(this,e,t)}function Ve(t){a.call(this,e,t)}function Ke(t){a.call(this,e,t)}function We(t){a.call(this,e,t)}function Ge(t){a.call(this,e,t)}function He(t){a.call(this,e,t)}function Je(t){a.call(this,e,t)}function Qe(t){F[t?"unshift":"push"](()=>{l=t,i(6,l)})}function je(t){F[t?"unshift":"push"](()=>{R=t,i(7,R)})}return e.$$set=t=>{"width"in t&&i(0,c=t.width),"height"in t&&i(1,u=t.height),"pixelRatio"in t&&i(11,h=t.pixelRatio),"style"in t&&i(2,o=t.style),"autoclear"in t&&i(12,f=t.autoclear),"layerEvents"in t&&i(3,v=t.layerEvents),"class"in t&&i(4,_=t.class),"$$scope"in t&&i(17,g=t.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&2048&&i(5,s=h??1),e.$$.dirty[0]&1&&i(16,y.width=c,y),e.$$.dirty[0]&2&&i(16,y.height=u,y),e.$$.dirty[0]&32&&i(16,y.pixelRatio=s,y),e.$$.dirty[0]&4096&&i(16,y.autoclear=f,y),e.$$.dirty[0]&71683&&y.redraw()},[c,u,o,v,_,s,l,R,ne,te,ie,h,f,x,$,ee,y,g,d,re,se,ae,le,oe,ue,he,de,ce,fe,pe,ge,ye,_e,me,we,ve,Le,be,Re,Ee,Ie,Se,Ce,ke,Te,De,Ae,Me,Pe,qe,Oe,Fe,ze,Xe,Ye,Be,Ne,Ue,Ve,Ke,We,Ge,He,Je,Qe,je]}class In extends z{constructor(n){super(),X(this,n,En,bn,Y,{width:0,height:1,pixelRatio:11,style:2,autoclear:12,layerEvents:3,class:4,redraw:13,getCanvas:14,getContext:15},null,[-1,-1,-1])}get redraw(){return this.$$.ctx[13]}get getCanvas(){return this.$$.ctx[14]}get getContext(){return this.$$.ctx[15]}}function Sn(e){let n;return{c(){n=S("div"),this.h()},l(i){n=C(i,"DIV",{"data-layer-id":!0}),T(n).forEach(L),this.h()},h(){b(n,"data-layer-id",e[0])},m(i,s){E(i,n,s)},p:P,i:P,o:P,d(i){i&&L(n)}}}function Cn(e,n,i){const{register:s,unregister:d,redraw:g}=Rn(),c=dn();let{setup:u=void 0}=n,{render:h=()=>{}}=n;const o=s({setup:u,render:h,dispatcher:c});return K(()=>d(o)),e.$$set=f=>{"setup"in f&&i(1,u=f.setup),"render"in f&&i(2,h=f.render)},e.$$.update=()=>{e.$$.dirty&4&&g()},[o,u,h]}class kn extends z{constructor(n){super(),X(this,n,Cn,Sn,Y,{setup:1,render:2})}}let U;const j=Date.now(),Z=e=>(e(Date.now()-j),U=window.requestAnimationFrame(()=>Z(e)),()=>window.cancelAnimationFrame(U));function Tn(){}const Dn=pn(Date.now()-j,typeof window>"u"?Tn:Z);function An(e){let n,i;return n=new kn({props:{render:e[3]}}),{c(){W(n.$$.fragment)},l(s){G(n.$$.fragment,s)},m(s,d){H(n,s,d),i=!0},p(s,d){const g={};d&8&&(g.render=s[3]),n.$set(g)},i(s){i||(B(n.$$.fragment,s),i=!0)},o(s){N(n.$$.fragment,s),i=!1},d(s){J(n,s)}}}function Mn(e){let n,i,s,d,g,c,u,h;return cn(e[6]),s=new In({props:{width:e[1],height:32,$$slots:{default:[An]},$$scope:{ctx:e}}}),{c(){n=S("input"),i=q(),W(s.$$.fragment),d=q(),g=S("p"),this.h()},l(o){n=C(o,"INPUT",{type:!0,accept:!0}),i=O(o),G(s.$$.fragment,o),d=O(o),g=C(o,"P",{}),T(g).forEach(L),this.h()},h(){b(n,"type","file"),b(n,"accept",".csv")},m(o,f){E(o,n,f),E(o,i,f),H(s,o,f),E(o,d,f),E(o,g,f),e[8](g),c=!0,u||(h=[r(window,"resize",e[6]),r(n,"change",e[7]),r(n,"change",e[4])],u=!0)},p(o,[f]){const v={};f&2&&(v.width=o[1]),f&1032&&(v.$$scope={dirty:f,ctx:o}),s.$set(v)},i(o){c||(B(s.$$.fragment,o),c=!0)},o(o){N(s.$$.fragment,o),c=!1},d(o){o&&L(n),o&&L(i),J(s,o),o&&L(d),o&&L(g),e[8](null),u=!1,V(h)}}}function Pn(e,n,i){let s,d;fn(e,Dn,l=>i(5,d=l));let g,c,u;const h=l=>{o(l.target.files)};function o(){const l=new FileReader,[p]=c;l.addEventListener("load",()=>{i(0,u.innerText=l.result,u)},!1),p&&l.readAsText(p)}function f(){i(1,g=window.innerWidth)}function v(){c=this.files,i(2,c)}function _(l){F[l?"unshift":"push"](()=>{u=l,i(0,u)})}return e.$$.update=()=>{e.$$.dirty&33&&i(3,s=({context:l,width:p,height:R})=>{u.innerText!=""&&(l.fillStyle=`hsl(${d/40}, 100%, 50%)`,l.beginPath(),l.rect(d*2%p,0,p/4,R),l.fill())})},[u,g,c,s,h,d,f,v,_]}class zn extends z{constructor(n){super(),X(this,n,Pn,Mn,Y,{})}}export{zn as default};
